{
  "rules":{
    "feed":{
      "$uid":{
        ".read":"auth.uid === $uid",
        ".write":"auth.uid === $uid",
        "$postId":{
          ".validate":"newData.val() === true && newData.parent().parent().parent().child('posts').child($postId).exists()"
        }
      }
    },
    "posts":{
      ".read":true,
      "$postId":{
        ".write":"(auth.uid === newData.child('author').child(uid).val()) || (!newData.exists() && auth.uid === data.child('uid').val())"
      }
    },
    "comments":{
      ".read":true,
      "$postId":{
        ".write":"!newData.exists() && auth.uid === root.child('posts').child($(postId).child('author').child('uid').val() && !newData.parent().parent().child('posts').child($postId).exists())",
        ".validate":"root.child('posts').child($postId).exists()",
        "$commentId":{
          ".write":"auth.uid === newData.child('author').child('uid').val()"
        }
      }
    },
    "likes":{
      ".read":true,
      "$postId":{
        ".write":"!newData.exists() && auth.uid === root.child('posts').child($postId).child('author').child('uid').val() && !newData.parent().parent().child('posts').child($postId).exists()",
        ".validate":"root.child('posts').child($postId).exists()",
        "$uid":{
          ".write":"auth.uid === $uid",
          ".validate":"newData.val() === now"
        }
      }
    },
    "followers":{
      ".read":true,
      "$followedUid":{
        "$followerUid":{
          ".write":"auth.uid === $followerUid",
          ".validate":"newData.val() === true && newData.parent().parent().parrent().child('people').child($followerUid).child('following').child($followedUid).exists()"
        }
      }
    },
    "people":{
      ".indexOn":["_search_index/full_name", "_search_index/reversed_full_name"],
      ".read":true,
      "$uid":{
        ".write":"auth.uid === $uid",
        "full_name":{
          ".validate":"newData.isString()"
        },
        "profile_picture":{
          ".validate":"newData.isString()"
        },
        "posts":{
          "$postId":{
            ".validate":"newData.val() === true && newData.parent().parent().parent().parent().child('posts').child($posstId).exists()"
          }
        },
        "_search_index":{
          "full_name":{
            ".validate":"newData.isstring()"
          },
          "_search_index":{
            "full_name":{
              ".validate":"newData.isString()"
            }
          },
          "reversed_full_name":{
            ".validate":"newData.isString()"
          }
        },
        "following":{
          "$followedUid":{

            ".validate": "newData.parent().parent().parent().parent().child('followers').child($followedUid).child($uid).val() === true"
          }
        }
      }
    }
  }
}
